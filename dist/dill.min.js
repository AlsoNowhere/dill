!function(){"use strict";var t=function(t){Object.seal(t),Object.freeze&&Object.freeze(t)},e=function(t){throw new Error(t)},n=function(n,i,r,a,o){"undefined"!==n&&""!==n||e("You must pass a name to create a Component (!name, data object, HTML template)");var u=null;this.name=n,this.baseData=void 0===i?{}:"function"==typeof i?new i:"object"==typeof i?i:e("You must pass an object or constructor function to create a Component (name, !data object, HTML template)"),this.template=r||"",this.isIsolated="isolate"===a,Object.defineProperty(this,"module",{get:function(){return u}}),this.setModule=function(t){null===u&&t instanceof s&&(u=t)},o&&(this.abstractConditions=o),t(this)},i=function(t){if(!(t instanceof n))throw new Error("You can only set an instance of Dill Component as a component");this.components[t.name]=t,this.components[t.name].setModule(this)},r=function(e,n,i){this.name=e,this.data="function"==typeof n?new n:n,this.isIsolated="isolate"===i,t(this)},a=function(t){if(!(t instanceof r))throw new Error("You can only set an instance of Dill Service as a service");this.services[t.name]=t},o=function(t,e){for(var n,i=0;i<t.length&&!1!==(n=e(t[i],i));)"number"==typeof n&&(i+=n),i++},s=function(){var e=function(n,i){void 0===i&&(i=[]),this.components={},this.services={},this.name=n;var r=this;o(i,function(t){t instanceof e&&(Object.keys(t.components).forEach(function(e){var n=t.components[e];n.isIsolated||(r.components[e]=n)}),Object.keys(t.services).forEach(function(e){var n=t.services[e];n.isIsolated||(r.services[e]=n)}))}),t(this)};return e.prototype={setComponent:i,setService:a},e}(),u=[],l=function(t,e){var n=t.split("{{");return o(n,function(t,i){var r=t.indexOf("}}");n[i]=-1===r?t:function(t,e){var n=e[t];return void 0===n&&(n=""),"'"===t.substr(0,1)&&"'"===t.substr(t.length-1,1)?t.substring(1,t.length-1):"function"==typeof n?n.apply(e):n}(t.substring(0,r),e)+t.substring(r+2,t.length)}),n.join("")},f=["value","checked"],d=function(t,e,n){var i=function(){for(var i in t)(function(){var e;Object.defineProperty(this,i,{get:function(){return e},set:function(t){e=t}}),this[i]=t[i]}).apply(this);null!==e&&void 0===n&&(this._parent=e)};return null!==e&&void 0===n&&(i.prototype=e),new i},c=function(e,n,i,r){var a=e.nodeName;if(this.name=e.nodeName,this.module=i,r&&(this.templateParent=r),"#text"===this.name)return this.value=e.nodeValue,this.data=n,t(this),this;this.children=[];var s=function(t,e){t.templateParent&&(t.component!==e?s(t.templateParent,e):l=!0)},u=i.components[a.toLowerCase()],l=!0;if(u&&u.abstractConditions&&(l=!1,o(u.abstractConditions,function(t){if(l)return!1;s(this,t)}.bind(this))),void 0!==u&&l)return this.component=u,e.hasAttribute("dill-for")?void(this.data=n):(this.data=d(u.baseData,n,e.hasAttribute("dill-isolate")?"isolate":void 0),this.data._module=u.module,e.removeAttribute("dill-isolate"),void o(e.attributes,function(t){var e=t.nodeName,i=t.nodeValue;this.data[e]=n[i]}.bind(this)));this.attributes=[],this.data=n},h=function(t,e,n){return void 0===n&&(n=e),t.substr(0,e.length)===e&&t.substr(t.length-n.length,t.length)===n},m=function(t){return":"===t.substr(0,1)},p=function(t){return":"===t.substr(t.length-1,1)},v=function(e,n,i){this.name=i.nodeName;var r=i.nodeValue;if("#"===this.name.substr(0,1))return n.data[this.name.substring(1)]=e,void(this.type="hashReference");var a=m(this.name)?this.name.substring(1,this.name.length):p(this.name)?this.name.substring(0,this.name.length-1):this.name.substring(1,this.name.length-1);this.type=function(t){var e=t.nodeName,n=t.nodeValue;return h(e,"[","]")||m(e)?h(n,"'")?"literal":"bind":h(e,"(",")")||p(e)?"event":"default"}(i),this.value="literal"===this.type?r.substring(1,r.length-1):r,"default"!==this.type&&(this.parsed=a);r=this.value;"event"!==this.type?t(this):e.addEventListener(this.parsed,function(t){!1!==n.data[r].apply(n.data,[t,this])&&dill.change()})},b=function(t,e,n,i){var r,a=new c(t,e,n,i);return e=a.data,"SCRIPT"===a.name?a:(t.attributes&&t.attributes["dill-extends"]&&function(t,e){var n=e.data[t.attributes["dill-extends"].nodeValue];t.removeAttribute("dill-extends"),"object"==typeof n&&Object.keys(n).forEach(function(e){var i=e;h(e,"[","]")&&(i=":"+e.substring(1,e.length-1)),h(e,"(",")")&&(i=e.substring(1,e.length-1)+":"),t.setAttribute(i,n[e])})}(t,a),t.attributes&&o(t.attributes,function(e,n){return"dill-if"===e.nodeName?function(t,e){var n=t.attributes["dill-if"].nodeValue,i="!"===n.substr(0,1);i&&(n=n.substring(1,n.length));var r="function"==typeof e.data[n]?e.data[n]():e.data[n];return i&&(r=!r),e.if={parent:t.parentNode,first:r,initial:!0,value:n,invert:i,target:t},t.removeAttribute("dill-if"),r}(t,a):"dill-template"!==e.nodeName?"dill-for"===e.nodeName?function(t,e){var n=t.attributes["dill-for"].nodeValue;e.for={parent:t.parentNode,initial:[null],templates:[null],value:n,first:!0},t.removeAttribute("dill-for"),e.for.clone=t.cloneNode(!0)}(t,a):void(!a.component&&a.attributes.push(new v(t,a,e))):void function(t,e){var n=t.attributes["dill-template"].nodeValue,i=e.data[n];t.innerHTML="function"==typeof i?i.apply(e.data):i,t.removeAttribute("dill-template")}(t,a)}),a.if&&!1===a.if.first?a:(a.attributes&&function(t,e){for(var n,i=t.length-1;i>=0&&!1!==(n=e(t[i],i));)"number"==typeof n&&(i-=n),i--}(a.attributes,function(e,n){"event"!==e.type&&"hashReference"!==e.type||a.attributes.splice(n,1),"default"!==e.type&&t.removeAttribute(e.name)}),a.component&&(a.for&&!a.for.first||!a.for)&&(a.data._template=t.innerHTML,t.innerHTML=a.component.template,r=t.getElementsByTagName(a.component.name.toUpperCase()),o(r,function(e){for(var n=!1,i=e;i!==t&&!n;)n=i.hasAttribute("dill-if"),i=i.parentNode;if(!n)throw new Error("Recursive element detected without conditional catch. To avoid infinite loop render was stopped.")}),a.data.hasOwnProperty("oninit")&&a.data.oninit()),(a.for&&!a.for.first||!a.for)&&t.childNodes&&o(t.childNodes,function(t){a.children.push(b(t,e,n,a))}),a.for&&(a.for.first=!1),a))},g=function(t,e){var n;for(n in t)e.hasOwnProperty(n)?e[n]=t[n]:function(){var i;Object.defineProperty(e,n,{get:function(){return i},set:function(t){i=t}}),e[n]=t[n]}();for(n in e)"_"!==n.substr(0,1)&&(t.hasOwnProperty(n)||delete e[n])},y=function(t,e,n,i){var r,a,s,u=e.name;if(i=i||{},n===t&&(n=!0),"#comment"===u||"SCRIPT"===u)return 1;if("#text"===u)return!0===n&&function(t,e){var n=t.nodeValue,i=l(e.value,e.data);n!==i&&(t.nodeValue=i)}(t,e),1;if(!0===n){if(!i.noIf&&e.hasOwnProperty("if")){if("added"===(r=function(t,e){var n,i=e.data,r=e.if.invert,a=e.if.value,o="function"==typeof i[a]?i[a]():i[a],s=r?!o:!!o,u=e.if.initial,l=e.if.parent;return!1===u&&!1===s?0:!1===u&&!0===s?(void 0===t?l.appendChild(e.if.target):l.insertBefore(e.if.target,t),!1===e.if.first&&(e.if.first=!0,n=b(e.if.target,e.data,e.data._module,e),e.attributes=n.attributes,e.children=n.children),e.if.initial=!0,e.component&&e.data.onadd&&e.data.onadd(),"added"):!0===u&&!1===s?(l.removeChild(e.if.target),e.component&&e.data.onremove&&e.data.onremove(),e.if.initial=!1,0):void 0}(t,e)))return y(t.previousElementSibling,e,n,{noIf:!0}),1;if(0===r)return r}if(e.hasOwnProperty("for")&&"number"==typeof(a=function(t,e,n){var i=e.for.initial.length,r="function"==typeof e.data[e.for.value]?e.data[e.for.value]():e.data[e.for.value];if(void 0===r)throw new Error("Count not find "+e.for.value+" on current scope.");var a=e.for.initial,o=r.length,s=t,u=e.for.parent,l=e.for.templates,f=function(){return e.for.clone.cloneNode(!0)};return i!==o&&(i>o&&function(){for(var t,e=0;e<o;)s=s.nextElementSibling,e++;for(;e<i;)t=s.nextElementSibling,u.removeChild(s),s=t,e++}(),i<o&&function(){for(var t,a=0;a<i-1;)s=s.nextElementSibling,a++;if(0===i){void 0===s?(s=f(),u.appendChild(s)):(u.insertBefore(f(),s),s=s.previousElementSibling);var c=d(r[0],e.data);c._item=r[0],c._index=0,t=b(s,c,e.module,e),l[0]=t,y(s,t,n)}for(;a<o-1;)s.insertAdjacentElement("afterend",f()),s=s.nextElementSibling,function(){var t=a+1,i=d(r[t],e.data);i._item=r[t],i._index=t;var o=b(s,i,e.module,e);l[t]=o,y(s,o,n)}(),a++}()),function(){var c,h=0;for(s=t;h<(i<o?i:o);)r[h]!==a[h]?(c=s.nextSibling,u.removeChild(s),null===c?(u.appendChild(f()),s=u.children[u.children.length-1]):(u.insertBefore(f(),c),s=c.previousElementSibling),function(){var t=d(r[h],e.data);t._item=r[h],t._index=h;var i=b(s,t,e.module,e);l[h]=i,y(s,i,n)}(),s=s.nextElementSibling,h++):("object"==typeof r[h]&&g(r[h],l[h].data),y(s,l[h],n),s=s.nextElementSibling,h++)}(),e.for.initial=r.map(function(t){return t}),o}(t,e,n)))return a;!function(t,e){e.attributes&&o(e.attributes,function(n){var i,r=n.type,a=n.parsed||n.name,o=l(n.value,e.data),s=!!t.attributes[a];if("bind"===r){if(i="function"==typeof e.data[o]?e.data[o].apply(e.data):e.data[o],f.indexOf(a)>-1){if(t[a]===i)return;return void(t[a]=i)}if(s){if(t.attributes[a].nodeValue===i)return;return void 0===i||!1===i?t.removeAttribute(a):void(t.attributes[a].nodeValue=i)}if(void 0===i||!1===i)return;t.setAttribute(a,i)}else if("literal"===r)t.setAttribute(a,o);else if("default"===r){if(s){if(t.attributes[a].nodeValue===o)return;return void(t.attributes[a].nodeValue=o)}t.setAttribute(a,o)}})}(t,e)}return s=0,o(e.children,function(e,i){var r=y(t.childNodes[s],e,n);s+=r}),1},w=function(t){o(u,function(e){y(e.target,e.template,t||!0)})};window.dill={render:function(t,e,n){if(!(n instanceof s))throw new Error("You must pass a Dill Module instance.");if("function"!=typeof e)throw new Error("You must pass a constructor function as the original Data.");if(!(t instanceof Element))throw new Error("You must pass a HTML element as the target.");var i=d(new e,null);i.oninit&&i.oninit(),i._module=n;var r=b(t,i,n);return u.push({target:t,template:r}),w(),i},change:w,clearRenders:function(){u.length=0},component:function(t,e,i,r,a){return new n(t,e,i,r,a)},service:function(t,e,n){return new r(t,e,n)},reset:function(){u.length=0},module:function(t,e){return new s(t,e)}}}();